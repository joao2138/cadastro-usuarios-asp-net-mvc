@using System.Text.Json
@using WebApplicationMVC.data
<!DOCTYPE html>
<html lang="pt-br">
<head>
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>@ViewData["Title"]</title>
   <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
   <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
   <link rel="stylesheet" href="~/WebApplicationMVC.styles.css" asp-append-version="true" />
   <link rel="stylesheet" href="~/css/toastBarCSS.css" />

   @RenderSection("Styles", required: false)

</head>
<body>

   @{
      var messages = TempData[Consts.InfoMessage] as IEnumerable<string> ?? Enumerable.Empty<string>();

      var modelStateErrors = ViewData.ModelState.Values
      .SelectMany(v => v.Errors)
      .Select(e => e.ErrorMessage);

      var allMessages = messages.Concat(modelStateErrors).Take(4);
   }


   <header>
      <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
         <div class="container-fluid">
            <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">Cadastro de usuários</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
               <span class="navbar-toggler-icon"></span>
            </button>
            <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
               <ul class="navbar-nav flex-grow-1">
                  <li class="nav-item">
                     <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">Home</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
                  </li>
                  <li class="nav-item">
                     <a class="nav-link text-dark" asp-area="" asp-controller="Account" asp-action="GetUsers">Listar Usuários</a>
                  </li>
               </ul>
               <div class="loginSection">
                  @{
                     var path = Context.Request.Path;

                     var isLoginPage = path.StartsWithSegments("/account/loginpage", StringComparison.OrdinalIgnoreCase) || path.StartsWithSegments("/auth/login", StringComparison.OrdinalIgnoreCase);
                  }
                  @if (User?.Identity?.IsAuthenticated ?? false)
                  {
                     <div class="d-flex align-items-center">
                        <a class="text-black text-decoration-none" href="/account/UserProfile"><span class="me-2">Olá, @(User.Claims.FirstOrDefault(x => x.Type == Consts.UserName)?.Value)</span></a>
                        <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#logoutModal">
                           Logout
                        </button>
                     </div>
                  }
                  else if (!isLoginPage)
                  {
                     <a class="btn btn-outline-primary btn-sm rounded-3" asp-controller="Account" asp-action="LoginPage">Login</a>
                  }
               </div>

            </div>
         </div>

      </nav>
   </header>
   <div class="container">
      <main role="main" class="pb-3">
         @RenderBody()
      </main>
   </div>


   <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
            <div class="modal-header border-bottom-0">
               <h5 class="modal-title" id="logoutModalLabel">Confirmar logout</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
               Tem certeza que deseja encerrar a sessão?
            </div>
            <div class="modal-footer border-top-0">
               <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
               <form asp-controller="Auth" asp-action="Logout" method="post" class="d-inline">
                  <button type="submit" class="btn btn-danger">Sair</button>
               </form>
            </div>
         </div>
      </div>
   </div>



   <script src="~/js/tryRenewSession.js"></script>
   <script src="~/lib/jquery/dist/jquery.min.js"></script>
   <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
   <script src="~/js/site.js" asp-append-version="true"></script>

   @await RenderSectionAsync("Scripts", required: false)


   <!-- ToastBar -->
   <div id="toastBar"
        class="toast-bar-container"
        style="display:none;"
        data-errors='@Html.Raw(JsonSerializer.Serialize(allMessages))'>
      <ul id="toastMessages" class="toast-bar-list"></ul>
   </div>

</body>
</html>
